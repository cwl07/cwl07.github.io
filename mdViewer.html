<!DOCTYPE html> 
<head> 
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!--Markdown-->
    <script src="./js/markdown-it/dist/markdown-it.min.js"></script>
    <script src="./js/markdown-it-sub/dist/markdown-it-sub.min.js"></script>
    <script src="./js/markdown-it-sup/dist/markdown-it-sup.min.js"></script>
    <script src="./js/markdown-it-footnote/dist/markdown-it-footnote.min.js"></script>
    <script src="./js/markdown-it-deflist/dist/markdown-it-deflist.min.js"></script>
    <script src="./js/markdown-it-mark/dist/markdown-it-mark.min.js"></script>
    <script src="./js/markdown-it-task-lists/dist/markdown-it-task-lists.min.js"></script>
    <script src="./js/markdown-it-anchor/dist/markdownItAnchor.umd.js"></script>
    <script src="./js/markdown-it-toc-done-right/dist/markdownItTocDoneRight.umd.js"></script>
    <script>
        var md = window.markdownit({
            html: true, //可以识别html
            linkify: true,//自动检测像链接的文本
            breaks: true,//回车换行
            typographer: true,//优化排版，标点
            //代码高亮
            highlight: function (str, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return '<pre class="hljs"><code>' +
                            hljs.highlight(lang, str, true).value +
                            '</code></pre>';
                    } catch (__) {}
                }
                return '<pre class="hljs"><code>' + md.utils.escapeHtml(str) + '</code></pre>';
            }
        })
        .use(window.markdownitSub)
        .use(window.markdownitSup)
        .use(window.markdownitFootnote)
        .use(window.markdownitDeflist)
        .use(window.markdownitTaskLists)
        .use(window.markdownitMark)
        .use(window.markdownItAnchor, {
            permalink: false,
            permalinkBefore: false,
            permalinkSymbol: '#'
        })
        .use(window.markdownItTocDoneRight, {
            containerClass: 'toc',
            containerId: 'toc',
            listType: 'ul',
            listClass: 'listClass',
            itemClass: 'itemClass',
            linkClass: 'linkClass',
            callback: function (html, ast) {
            //把目录单独列出来
                left.innerHTML = html;
            }
        });
    </script>
    <!--代码高亮highlight-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/rainbow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- and it's easy to individually load additional languages -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
    <script>hljs.highlightAll();</script>

    <!--解决latex-->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        MathJax = {
          tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head> 
<body id="background_image">
    
    <style>
        code
        {
            font-size: 16px;
        }
    </style>
    <div style="background-color: rgba(248, 246, 231, 0.898);margin-left: 15vw;margin-right: 15vw;padding-left: 20px;padding-right: 20px;border-radius: 10px;padding-top: 5px;padding-bottom: 5px;">
    <script>
        /*获取文件*/
        function getQueryVariable(variable)
        {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == variable){return pair[1];}
            }
            return("404.html");
        }
        //console.log(getQueryVariable("file"));
        /*get .md file*/ 
        var xhr = new XMLHttpRequest(); 
        //xhr.responseType = "blob"; 
        xhr.open("GET", getQueryVariable("file"), false); 
        xhr.send();

        var text = "";
        var inlatex = 0;
        for(var i=0;i<xhr.responseText.length;++i)
        {
            if(xhr.responseText[i]=='$'&&(i==0||xhr.responseText[i-1]!='$')) {inlatex ^= 1;}
            if(xhr.responseText[i]=='*'&&inlatex==1)
            {
                text += "\\\*";
                continue;
            }
            if(i+2<xhr.responseText.length&&
                xhr.responseText[i]=='\n'&&
                xhr.responseText[i+1]=='='&&
                xhr.responseText[i+2]=='\n'&&
                inlatex==1)
            {
                text += '=';
                i += 2;
                continue;
            }
            if(i+1<xhr.responseText.length&&
                xhr.responseText[i]=='\\'&&
                xhr.responseText[i+1]=='\\'&&
                inlatex==1)
            {
                text += "\\\\\\\\";
                i += 1;
                continue;
            }

            text += xhr.responseText[i];
        }
        console.log(text);
        
        var md = window.markdownit();
        document.write(md.render(text));
    </script>
    </div>
    
</body>
